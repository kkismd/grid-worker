# VTL-2 言語リファレンス

このドキュメントは、Altair 680用のオリジナルVTL-2言語仕様の要約です。  
出典: Altair 680-VTL-2 Manual-05-Beta 1 (Copyright 1976, 1977, Gary Shannon & Frank McCoy)

## 概要

VTL-2 (Very Tiny Language) は、Altair 680コンピュータシステム向けに開発された超小型プログラミング言語です。わずか768バイトのROMに収まりながら、初心者から上級者まで使える強力な機能を提供します。

## 基本概念

### ステートメントの種類

1. **直接ステートメント**: 行番号なし、入力後即座に実行
2. **プログラムステートメント**: 行番号あり、プログラム実行時に実行

### 行番号

- 範囲: 1-65535（0は使用不可）
- 各プログラムステートメントの前に必須
- ステートメントとの間に1つの空白が必要
- 10刻み（10, 20, 30...）の使用を推奨
- 各行は73文字未満、改行で終了

### 変数

- **単一文字**: 英字大文字1文字または特殊記号1文字
- 使用可能な文字: `!"#$%&&'()=-+*:;?/>.<,[]`
- **値の範囲**: 0-65535（数値）またはASCII文字1文字
- 数値と文字の相互変換が可能（例: 'A'+1='B'）

### システム変数

特定の機能を持つ予約変数:

#### `#` (行番号変数)
- 現在実行中の行番号を保持
- 値を変更すると制御フローが変わる（GOTO機能）
- `#=300` は "GOTO 300" と同等
- `#=0` は無視され、次の行が実行される

#### `!` (復帰アドレス変数)
- `#`が変更されたとき、旧行番号+1を保存
- サブルーチンからの復帰に使用（GOSUB/RETURN機能）
- `#=!` でサブルーチンから戻る

#### `?` (入出力変数)
- ユーザー端末を表す
- 等号の左側: 出力（`?="HELLO"`）
- 等号の右側: 入力（`A=?`）

#### `$` (改行制御変数)
- 出力後の自動改行を制御
- `$=0`: 改行なし
- `$=非0`: 改行あり（デフォルト）
- 入力時も同様に動作

#### `&` (プログラムポインタ)
- プログラムテキストの現在位置
- LIST、DELETE、EDIT機能で使用
- `&=1`: プログラムの先頭に移動

#### `%` (ステートメント長)
- 現在の行の長さ（バイト数）
- プログラム検索・操作に使用

## 演算子

### 算術演算子

- `+` 加算
- `-` 減算
- `*` 乗算
- `/` 除算（整数除算）

### 比較演算子（論理値を返す）

- `=` 等しい（真:1, 偽:0）
- `>` 以上（真:1, 偽:0）
- `<` 未満（真:1, 偽:0）

### 演算の順序

- **左から右へ**厳格に実行
- 括弧を使って順序を変更可能
- 例:
  - `Y=A*X*X+B*X+C` は `Y=((A*X)*X+B)*X+C`
  - `Y=(A*X*X)+(B*X)+C` は括弧で順序を制御

## メモリアクセス

### 配列（メモリ参照）

#### 基本構文
- `:変数)` - 変数の値をアドレスとして使用
- `:{式})` - 式の値をアドレスとして使用

#### 読み取り
```
A=:B)         ; Bの値をアドレスとして、そのメモリの内容をAに代入
A=:{B+10})    ; B+10のアドレスから読み取り
```

#### 書き込み
```
:B)=65        ; Bの値をアドレスとして、そこに65を書き込む
:{B+10})=A    ; B+10のアドレスにAの値を書き込む
```

## 制御構造

### 条件分岐（IF文相当）

比較演算子を使って条件分岐を実現:

```
10 #=(X=25)*50    ; もしX=25ならば行50へジャンプ（そうでなければ次行へ）
```

仕組み:
- `X=25` が真なら1、偽なら0を返す
- `1*50=50` → `#=50` でジャンプ
- `0*50=0` → `#=0` は無視され次行へ

### ループ

#### FOR-NEXTループ相当
```
10 I=1           ; 初期化
20 ...処理...
30 I=I+1         ; インクリメント
40 #=(I<11)*20   ; I<11ならば行20へ戻る
```

### サブルーチン

```
10 #=100         ; サブルーチン100を呼び出し
20 ...           ; ここに戻る
...
100 ...処理...
110 #=!          ; 呼び出し元に戻る
```

## コマンド

### プログラム制御

#### `#=行番号`
- 指定行からプログラム実行を開始
- `#=10` で行10から実行

### リスト表示

#### `&=1`
プログラムの先頭にポインタを移動

#### `%=行番号`
指定行に移動してリスト表示

### プログラム削除

#### `&=1` の後 `%=0`
プログラム全体を削除（New相当）

## 入出力フォーマット制御

### 出力

#### 文字列出力
```
?="HELLO"        ; "HELLO"を出力（自動改行あり）
$=0
?="HELLO"        ; "HELLO"を出力（改行なし）
$=13
```

#### 数値出力
```
?=123            ; "123"を出力
```

#### 文字出力
```
?=65             ; 'A'を出力（65はASCIIコード）
```

### 入力

#### 数値入力
```
A=?              ; 数値を入力してAに代入
```

#### 文字入力
```
$=0
A=?              ; 1文字入力（エコーバックなし）
$=13
```

## プログラム例

### Hello World
```
10 ?="HELLO WORLD"
```

### 1から10まで表示
```
10 I=1
20 ?=I
30 I=I+1
40 #=(I<11)*20
```

### 数値入力と判定
```
10 ?="NUMBER? ";
20 $=0
30 A=?
40 $=13
50 #=(A=5)*100
60 ?="NOT 5"
70 #=999
100 ?="YOU GOT IT!"
999 *=0
```

### 配列の使用例
```
10 A=1000        ; 配列の開始アドレス
20 I=0
30 :{A+I})=I*10  ; A[I]=I*10 相当
40 I=I+1
50 #=(I<10)*30
60 I=0
70 ?=:{A+I})     ; A[I]を出力
80 I=I+1
90 #=(I<10)*70
```

## 特殊機能

### プログラムの終了

#### `*=0`
実行を終了し、待機モードに戻る

### タイミング制御

一部の実装では以下の機能がある:

#### `"`（ダブルクォート変数）
短い遅延を生成

#### `'`（シングルクォート変数）
やや長い遅延を生成

## プログラミングのヒント

### 条件式の最適化

左から右への評価を利用して省スペース化:

```
; 非最適:
20 #=(X=25)*50

; 最適（2バイト節約）:
20 #=X=25*50
```

### メモリ効率

- 不要な空白を削除
- 行番号を詰める（ただし、後で挿入の余地を残す）
- 同じ処理はサブルーチン化

### デバッグ

- `?=#` で現在の行番号を表示
- `?=変数名` で変数の値を確認
- 直接ステートメントで式を評価（例: `?=A+B`）

## 制限事項

- 行の長さ: 73文字未満
- 変数名: 1文字のみ
- 数値範囲: 0-65535（符号なし16ビット）
- ネストされた括弧: 実装依存（通常は限定的）
- エラーハンドリング: 基本的なエラー検出のみ

## VTL-2の特徴

### 利点

1. **超小型**: わずか768バイトのROM
2. **シンプル**: 最小限の構文規則
3. **柔軟**: 数値と文字の相互変換可能
4. **強力**: メモリ直接アクセス、I/O制御

### 設計思想

- キーワードの代わりにシステム変数を使用
- 一貫性のある文法
- 左から右への単純な評価

## 互換性と移植

VTL-2は以下のシステムに移植されています:

- Altair 680（オリジナル）
- Altair 8800
- C言語実装版
- その他のプラットフォーム

各実装で若干の違いがありますが、基本的な言語仕様は共通しています。

---

## 参考: オリジナルマニュアルの特記事項

- システム変数の使用により言語サイズを最小化
- 単純な文法ながら強力なメモリ操作が可能
- 初心者から上級者まで段階的に学習可能
- 教育用途やリソース制約のある環境に最適

このリファレンスは、Altair 680-VTL-2 Manual (Beta 1) からの要約であり、実装の詳細や追加機能については原文を参照してください。
