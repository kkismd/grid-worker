# WorkerScript 記号リソース管理表

## 概要| `<>` | 不等号 | `A<>B` | 複合比較演算子（唯一の不等号） |
| `&` | 論理AND | `A&B` | 論理演算子 |WorkerScript言語において、ASCII記号は貴重なリソースです。この文書では現在の使用状況と将来の拡張計画を体系的に管理します。

## ASCII記号使用状況一覧

### 🔴 使用済み記号（変更不可）

#### コマンド・制御構造
| 記号 | 用途 | 例 | 備考 |
|------|------|-----|------|
| `?` | 出力命令 | `?=100` | トランスクリプト出力 |
| `;` | IF文 | `;=A>5 ?=A` | 条件分岐 |
| `@` | NEXT文 | `@=I` | FORループ終了 |
| `/` | 改行出力 | `/` | 独立したステートメント |

#### 演算子
| 記号 | 用途 | 例 | 備考 |
|------|------|-----|------|
| `+` | 加算 | `A+B` | 算術演算子 |
| `-` | 減算 | `A-B` | 算術演算子、単項マイナス |
| `*` | 乗算 | `A*B` | 算術演算子 |
| `/` | 除算 | `A/B` | 算術演算子（改行出力と兼用） |
| `%` | 剰余 | `A%B` | 算術演算子 |
| `=` | 代入・比較 | `A=B`, `A=B` | 文脈で判別 |
| `>` | 大なり | `A>B` | 比較演算子 |
| `<` | 小なり | `A<B` | 比較演算子 |
| `>=` | 以上 | `A>=B` | 複合比較演算子 |
| `<=` | 以下 | `A<=B` | 複合比較演算子 |
| `<>` | 不等 | `A<>B` | 複合比較演算子 |
| `&` | 論理AND | `A&B` | 論理演算子 |
| `\|` | 論理OR | `A\|B` | 論理演算子 |
| `!` | 論理NOT | `!A` | 単項論理演算子 |

#### システム変数・制御
| 記号 | 用途 | 例 | 備考 |
|------|------|-----|------|
| `#` | プログラムポインタ | `#=^LABEL`, `#=!`, `#=-1` | GOTO・RETURN・HALT制御専用 |
| `~` | ランダム数 | `A=~` | 0-32767のランダム値 |
| `` ` `` | グリッドアクセス | `` A=` `` | PEEK/POKE操作 |
| `!` | GOSUB・RETURN | `!=^SUB`, `#=!` | サブルーチン呼び出し・復帰の統一記号 |
| `$` | 文字I/O | `$=65` | 1バイトデータ出力 |

#### 区切り・括弧
| 記号 | 用途 | 例 | 備考 |
|------|------|-----|------|
| `,` | 区切り | `I=1,100,2` | FOR文パラメータ区切り |
| `(` | 左括弧 | `(A+B)*C` | 式の優先順位 |
| `)` | 右括弧 | `(A+B)*C` | 式の優先順位 |
| `^` | ラベルプリフィックス | `^START` | ラベル定義 |
| `:` | コメント | `: comment` | 行コメント |
| `"` | 文字列区切り | `"Hello"` | 文字列リテラル |
| `'` | 文字リテラル | `'A'` | 単一文字（ASCII値） |

### 🟡 拡張計画記号

#### 配列・メモリアクセス（最有力候補）
| 記号 | 計画用途 | 例 | 優先度 |
|------|----------|-----|--------|
| `[` | 配列アクセス開始 | `[A+5]=100` | 最高 |
| `]` | 配列アクセス終了 | `B=[A+5]` | 最高 |

#### 拡張コマンド
| 記号 | 計画用途 | 例 | 優先度 |
|------|----------|-----|--------|
| `\` | 拡張コマンド | `\MAX=A,B` | 高 |

#### システム変数拡張
| 記号 | 計画用途 | 例 | 優先度 |
|------|----------|-----|--------|
| `_` | システム変数プリフィックス | `_S=value` | 中 |

### 🟢 利用可能記号（未使用）

| 記号 | ASCII | 備考 | 候補用途 |
|------|-------|------|---------|
| `]` | 93 | 右角括弧 | 配列アクセス終了（最有力） |
| `{` | 123 | 左波括弧 | ブロック構造、代替配列記法 |
| `}` | 125 | 右波括弧 | ブロック構造、代替配列記法 |
| `\` | 92 | バックスラッシュ | 拡張コマンドプリフィックス |
| `_` | 95 | アンダースコア | システム変数プリフィックス |

## 🎯 言語設計の指針

### 記号使用の原則
1. **統一性**: 関連する機能は同一記号で統一（例: `!` でGOSUB/RETURN）
2. **簡潔性**: 冗長な記号用途を削除（例: `#` 不等号廃止）
3. **拡張性**: 将来の機能拡張を見据えた記号予約
4. **直観性**: コードの字面から機能が判断できる設計

### ✅ 改善済みの合理化
- **不等号統一**: `<>` 記号に統一（`#` 不等号廃止）
- **制御統一**: `#` はプログラムポインタ専用、`!` でサブルーチン統一
- **記号解放**: `]` 記号を配列アクセス用に解放

### 🔍 発見した追加の不整合

#### 1. FOR/NEXTループの不整合
```
現状: I=1,100  (変数代入形式)
      @=I      (@ 記号使用)
```
**問題**: FOR文は通常の変数代入、NEXT文は特殊記号で統一性なし

**🎯 GOSUB/RETURNパターン適用案**:
```
@=I,1,100     ← ループ開始 (@ 記号統一)
  ...処理...
#=@           ← ループ終了 (# 記号で対称終了)
```
**利点**: `!=^SUB`→`#=!` と同じ「開始記号」→「#=開始記号」パターン

#### 2. PEEK/POKEの制約
```
現状: A=`      (グリッド専用)
      `=A      (グリッド専用)
```
**問題**: グリッド座標(X,Y)固定で汎用メモリアクセス不可
**改善案**: 配列アクセス `[address]` で汎用化

#### 3. 出力系の断片化
```
現状: ?=value  (出力コマンド)
      /        (改行コマンド)
```
**問題**: 関連機能が別記号で一貫性なし
**改善方向**: 出力系の統一または現状維持検討

## 🚀 拡張ロードマップ

### フェーズ1: 配列・スタック機能（最優先）
```workerscript
[A+5]=100        → メモリ書き込み（ポインタ演算対応）
B=[A+5]          → メモリ読み込み
[-1]=value       → スタックプッシュ（リテラル-1のみ）
result=[-1]      → スタックポップ
```
**利点**: 他言語との親和性、直感的なメモリアクセス

### フェーズ2: 拡張コマンド機能
```workerscript
\MAX=A,B         → 最大値計算
\SQRT=A          → 平方根計算
C=\MIN=A,B       → 最小値計算して結果を格納
```
**利点**: プラグイン対応、機能拡張の柔軟性

### フェーズ3: システム変数拡張
```workerscript
S=65000          → スタックポインタ設定（予約変数方式）
M=memory_usage   → メモリ使用量取得
```
**利点**: VTL文法との完全互換性

## 記号利用優先度

| 優先度 | 記号 | 用途 | 実装時期 |
|--------|------|------|----------|
| 🔥 最高 | `[` `]` | 配列アクセス | フェーズ1 |
| 🚀 高 | `\` | 拡張コマンド | フェーズ2 |
| 📋 中 | `{` `}` | 代替記法・ブロック | 将来検討 |
| 🔧 低 | `_` | システム変数 | フェーズ3 |

## � 実装効果

### ✅ 完了した改善
- **記号統一**: GOSUB(`!=^SUB`) / RETURN(`#=!`) が `!` で統一
- **文法簡潔化**: 不等号は `<>` のみに統一
- **記号解放**: `]` 記号が配列アクセス用に利用可能

### 🎯 拡張準備完了
- **配列アクセス**: `[address]` 記法の実装準備完了
- **記号管理**: 体系的な記号使用計画が確立
- **将来性**: 計画的な言語拡張が可能

### 📊 現在の記号使用率
- **使用済み**: 20記号（制御・演算・区切り）
- **計画済み**: 4記号（配列・拡張コマンド）
- **予約済み**: 3記号（システム変数・ブロック）
- **利用可能**: 多数（将来拡張用）

---
*最終更新: 2025年10月18日*
*参照: worker.md, src/workerInterpreter.ts, CORE_EXTENSIONS.md*