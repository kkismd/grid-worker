# リファクタリング課題メモ

## 長期的な課題

### 1. スペース区切りを活用したパーサーの簡素化

**現状の問題:**
- 現在の実装は、通常のプログラミング言語のようにトークン化を行っている
- ステートメント内のスペースをスキップし、トークンを連続的に処理
- 次のステートメント開始位置を探すために複雑なロジック（`isStatementStart()` + IDENTIFIER後の`=`チェック）が必要

**WorkerScriptの仕様:**
- worker.mdに明記：「複数のステートメントを同じ行に記述する場合、各ステートメントは1つ以上のスペースで区切られます」
- これは**ステートメント内にスペースが含まれない**ことを意味する（文字列リテラル内を除く）

**仕様を活かしたアプローチ:**
1. 行をスペースで分割 → ステートメント単位の文字列に
2. 文字列リテラル（ダブルクォート）内のスペースは保護
3. 各ステートメント文字列を個別にトークン化
4. 複雑な「次のステートメント検出」ロジックが不要に

**メリット:**
- パーサーコードが大幅に簡潔化
- 仕様の意図に沿った実装
- エラーメッセージがより正確（ステートメント単位）
- パフォーマンス向上の可能性

**実装タイミング:**
- 現在の実装は正しく動作しており、全72テスト合格
- Phase 3（インタプリタ実装）完了後にリファクタリングを検討
- または、Phase 2完了時点でのリファクタリングサイクルで対応

**影響範囲:**
- `Lexer.tokenizeLine()` - スペース分割ロジックを追加
- `WorkerInterpreter.parseLineStatements()` - ステートメント単位でトークン化
- 既存のテストは全て維持（動作は変わらない）

**参考:**
- worker.md 6章「コマンド (ステートメント)」
- 現在の実装: src/workerInterpreter.ts 318-353行目（出力ステートメント解析の複雑なロジック）
