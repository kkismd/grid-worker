# CLI Runnerãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã®è¨­è¨ˆ

## æ¦‚è¦

WorkerInterpreterã«å®Ÿè£…æ¸ˆã¿ã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã¨ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œæ©Ÿèƒ½ã‚’CLI runnerã‹ã‚‰åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹ãŸã‚ã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€‚

## èƒŒæ™¯

### æ—¢å­˜å®Ÿè£…ã®çŠ¶æ³

1. **WorkerInterpreter**: `src/workerInterpreter.ts`ã«ãƒ‡ãƒãƒƒã‚°APIãŒå®Ÿè£…æ¸ˆã¿
   - ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç†: `setBreakpoint()`, `removeBreakpoint()`, `clearBreakpoints()`, `getBreakpoints()`
   - å®Ÿè¡Œåˆ¶å¾¡: `continue()`, `stepIn()`, `stepOver()`, `stepOut()`
   - ãƒ‡ãƒãƒƒã‚°æƒ…å ±å–å¾—: `getCurrentLine()`, `getVariables()`, `getCallStack()`, `getDebugMode()`

2. **CLIã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ **: `src/cli.ts`ã«8ã¤ã®ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ãŒæ—¢ã«å­˜åœ¨
   - `run`, `exec`, `debug`, `watch`, `text`, `play`, `repl`, `bench`

3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `docs/feature/251026-breakpoint-step-execution/`ã«è©³ç´°ãªãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ä»•æ§˜ã‚ã‚Š

## è¨­è¨ˆæ–¹é‡

### åŸºæœ¬ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

æ—¢å­˜ã®`debug`ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã¯è©³ç´°ãƒ­ã‚°å‡ºåŠ›ç”¨ã¨ã—ã¦ç¶­æŒã—ã€æ–°ã—ãã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒãƒƒã‚°å°‚ç”¨ã®ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã€‚

### å®Ÿè£…ã®åŸå‰‡

1. **æœ€å°é™ã®å¤‰æ›´**: æ—¢å­˜ã®CLIRunnerã‚„WorkerInterpreterã®å‹•ä½œã‚’å¤‰æ›´ã—ãªã„
2. **å†åˆ©ç”¨**: WorkerInterpreterã®ãƒ‡ãƒãƒƒã‚°APIã‚’æœ€å¤§é™æ´»ç”¨
3. **ç›´æ„Ÿçš„ãªUX**: GDBã‚„Node.js Debuggerã«é¡ä¼¼ã—ãŸã‚³ãƒãƒ³ãƒ‰ä½“ç³»
4. **æ®µéšçš„å®Ÿè£…**: Phase 1ï¼ˆå¿…é ˆï¼‰â†’ Phase 2ï¼ˆæ‹¡å¼µï¼‰â†’ Phase 3ï¼ˆé«˜åº¦ï¼‰ã®é †ã§å®Ÿè£…

## æ©Ÿèƒ½è¨­è¨ˆ

### 1. æ–°è¦ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰: `breakpoint`

```bash
# åŸºæœ¬å®Ÿè¡Œ
npm run cli breakpoint examples/test.ws

# ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆä»˜ãå®Ÿè¡Œ
npm run cli breakpoint examples/test.ws --break-at 2,5

# é–‹å§‹æ™‚ã«ãƒ–ãƒ¬ãƒ¼ã‚¯
npm run cli breakpoint examples/test.ws --break-on-start
```

**ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰å®šç¾©:**
```typescript
breakpoint: {
    name: 'breakpoint',
    description: 'ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ',
    runner: 'debug',
    defaults: {
        debug: true,
        verbose: false,
        unlimitedSteps: true,
        quiet: false
    }
}
```

### 2. ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

#### æ–°è¦è¿½åŠ ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```typescript
interface DebugCLIOptions extends CLIOptions {
    breakAt?: string;           // "2,5,10" å½¢å¼ã®è¡Œç•ªå·ãƒªã‚¹ãƒˆ
    breakOnStart?: boolean;     // é–‹å§‹æ™‚ã«å³åº§ã«ãƒ–ãƒ¬ãƒ¼ã‚¯
    stepMode?: boolean;         // ã‚¹ãƒ†ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰ã§é–‹å§‹
    showContext?: number;       // ç¾åœ¨è¡Œã®å‰å¾Œä½•è¡Œã‚’è¡¨ç¤ºã™ã‚‹ã‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2ï¼‰
}
```

**ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°:**
- `--break-at <lines>` / `-b <lines>`: ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®è¡Œç•ªå·ãƒªã‚¹ãƒˆ
- `--break-on-start`: æœ€åˆã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆå®Ÿè¡Œå‰ã«ãƒ–ãƒ¬ãƒ¼ã‚¯
- `--step-mode`: å„ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆå®Ÿè¡Œå¾Œã«è‡ªå‹•çš„ã«ãƒ–ãƒ¬ãƒ¼ã‚¯
- `--context <n>`: ç¾åœ¨è¡Œã®å‰å¾Œnè¡Œã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2ï¼‰

### 3. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰

ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆåœæ­¢æ™‚ã«åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ä½“ç³»:

#### å®Ÿè¡Œåˆ¶å¾¡ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | ã‚¨ã‚¤ãƒªã‚¢ã‚¹ | èª¬æ˜ |
|---------|-----------|------|
| `continue` | `c` | æ¬¡ã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã¾ã§å®Ÿè¡Œ |
| `step` | `s`, `stepIn` | ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ï¼ˆæ¬¡ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆå®Ÿè¡Œï¼‰ |
| `next` | `n`, `stepOver` | ã‚¹ãƒ†ãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼ï¼ˆã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼‰ |
| `out` | `o`, `stepOut` | ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ã‚¦ãƒˆï¼ˆã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‹ã‚‰æŠœã‘ã‚‹ï¼‰ |

#### ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç†ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | ã‚¨ã‚¤ãƒªã‚¢ã‚¹ | èª¬æ˜ |
|---------|-----------|------|
| `break <line>` | `b <line>` | æŒ‡å®šè¡Œã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¿½åŠ  |
| `delete <line>` | `d <line>` | æŒ‡å®šè¡Œã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆå‰Šé™¤ |
| `breakpoints` | `bl`, `list-breaks` | ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º |
| `clear-breaks` | `bc` | å…¨ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚¯ãƒªã‚¢ |

#### æƒ…å ±è¡¨ç¤ºã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | ã‚¨ã‚¤ãƒªã‚¢ã‚¹ | èª¬æ˜ |
|---------|-----------|------|
| `print <var>` | `p <var>` | å¤‰æ•°ã®å€¤ã‚’è¡¨ç¤º |
| `variables` | `vars`, `v` | å…¨å¤‰æ•°ã‚’è¡¨ç¤º |
| `line` | `l`, `where` | ç¾åœ¨ã®è¡Œã‚’è¡¨ç¤º |
| `list [n]` | `ls [n]` | ç¾åœ¨è¡Œã®å‰å¾Œnè¡Œã‚’è¡¨ç¤º |
| `stack` | `bt`, `backtrace` | ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚’è¡¨ç¤º |
| `grid [size]` | `g [size]` | ã‚°ãƒªãƒƒãƒ‰ã®ä¸€éƒ¨ã‚’è¡¨ç¤º |

#### ãã®ä»–ã®ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | ã‚¨ã‚¤ãƒªã‚¢ã‚¹ | èª¬æ˜ |
|---------|-----------|------|
| `help` | `h`, `?` | ãƒ˜ãƒ«ãƒ—è¡¨ç¤º |
| `quit` | `q`, `exit` | ãƒ‡ãƒãƒƒã‚°çµ‚äº† |

### 4. ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®è¡¨ç¤ºå½¢å¼

#### ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆåœæ­¢æ™‚ã®è¡¨ç¤º

```
ğŸ”´ Breakpoint at line 2
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  0 â”‚ A=0
  1 â”‚ ^LOOP
â–¶ 2 â”‚ A=A+1
  3 â”‚ !(A)
  4 â”‚ IF A<10 GOTO ^LOOP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Variables: A=1, X=0, Y=0
Call Stack: [] (depth: 0)
Mode: break

debug> 
```

#### å„ç¨®æƒ…å ±è¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

**å¤‰æ•°è¡¨ç¤º:**
```
debug> p A
A = 5

debug> vars
Variables (3):
  A = 5
  B = 10
  X = 2
```

**ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯è¡¨ç¤º:**
```
debug> stack
Call Stack (depth: 2):
  #0: line 15 (current)
  #1: line 8  (caller)
  #2: line 2  (caller)
```

**ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º:**
```
debug> grid 5
Grid (top-left 5x5):
   0 1 2 3 4
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
0 â”‚â–‘ . . . .â”‚
1 â”‚. â–‘ . . .â”‚
2 â”‚. . â–‘ . .â”‚
3 â”‚. . . â–‘ .â”‚
4 â”‚. . . . â–‘â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ã‚¯ãƒ©ã‚¹æ§‹é€ 

```
CLIRunner (æ—¢å­˜)
    â†‘
    â”‚
DebugCLIRunner (æ–°è¦)
    â”œâ”€ debugLoop(): Promise<void>
    â”œâ”€ handleCommand(cmd: string): Promise<boolean>
    â”œâ”€ displayDebugState(): void
    â”œâ”€ displayCurrentLine(context: number): void
    â”œâ”€ displayVariables(): void
    â”œâ”€ displayCallStack(): void
    â””â”€ displayGrid(size: number): void
```

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
â”œâ”€â”€ cli.ts                          (å¤‰æ›´: breakpointã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰è¿½åŠ )
â”œâ”€â”€ cliRunner.ts                    (å¤‰æ›´ãªã—)
â”œâ”€â”€ debugCLIRunner.ts               (æ–°è¦: ãƒ‡ãƒãƒƒã‚°å°‚ç”¨ãƒ©ãƒ³ãƒŠãƒ¼)
â””â”€â”€ workerInterpreter.ts            (å¤‰æ›´ãªã—: æ—¢å­˜APIåˆ©ç”¨)
```

### DebugCLIRunnerã‚¯ãƒ©ã‚¹ã®è¨­è¨ˆ

```typescript
export interface DebugCLIRunnerConfig extends CLIRunnerConfig {
    breakAt?: number[];         // åˆæœŸãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ
    breakOnStart?: boolean;     // é–‹å§‹æ™‚ã«ãƒ–ãƒ¬ãƒ¼ã‚¯
    stepMode?: boolean;         // ã‚¹ãƒ†ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰
    showContext?: number;       // è¡¨ç¤ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¡Œæ•°
}

export class DebugCLIRunner extends CLIRunner {
    private interpreter: WorkerInterpreter;
    private generator: Generator<void, void, void> | null = null;
    private isDebugging: boolean = true;
    private rl: readline.Interface;
    private scriptLines: string[] = [];
    
    constructor(config: DebugCLIRunnerConfig);
    
    // ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
    async executeScript(script: string, scriptName?: string): Promise<void>;
    
    // ãƒ‡ãƒãƒƒã‚°ãƒ«ãƒ¼ãƒ—
    private async debugLoop(): Promise<void>;
    
    // ã‚³ãƒãƒ³ãƒ‰å‡¦ç†
    private async handleCommand(command: string): Promise<boolean>;
    
    // å®Ÿè¡Œåˆ¶å¾¡
    private async continueExecution(): Promise<void>;
    private async stepIn(): Promise<void>;
    private async stepOver(): Promise<void>;
    private async stepOut(): Promise<void>;
    
    // è¡¨ç¤ºæ©Ÿèƒ½
    private displayDebugState(): void;
    private displayCurrentLine(context: number): void;
    private displayVariables(varName?: string): void;
    private displayCallStack(): void;
    private displayGrid(size?: number): void;
    private displayBreakpoints(): void;
    
    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    private setupBreakpoints(lines: number[]): void;
    private waitForBreak(): Promise<void>;
    private parseCommand(input: string): { command: string; args: string[] };
}
```

### å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
1. DebugCLIRunner.executeScript()
   â†“
2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ­ãƒ¼ãƒ‰ & ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿åˆæœŸåŒ–
   â†“
3. åˆæœŸãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®š
   â†“
4. generator = interpreter.run()
   â†“
5. debugLoop() é–‹å§‹
   â†“
6. [ãƒ«ãƒ¼ãƒ—]
   â”œâ”€ generator.next() å®Ÿè¡Œ
   â”œâ”€ ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚§ãƒƒã‚¯
   â”œâ”€ ãƒ–ãƒ¬ãƒ¼ã‚¯æ™‚: displayDebugState()
   â”œâ”€ ã‚³ãƒãƒ³ãƒ‰å…¥åŠ›å¾…ã¡
   â”œâ”€ handleCommand() ã§ã‚³ãƒãƒ³ãƒ‰å‡¦ç†
   â””â”€ doneåˆ¤å®š
   â†“
7. å®Ÿè¡Œå®Œäº† & çµæœè¡¨ç¤º
```

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: å¿…é ˆæ©Ÿèƒ½ï¼ˆMVPï¼‰

**ç›®æ¨™**: åŸºæœ¬çš„ãªãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã¨ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã‚’å®Ÿç¾

**å®Ÿè£…é …ç›®:**
1. `DebugCLIRunner`ã‚¯ãƒ©ã‚¹ã®åŸºæœ¬æ§‹é€ 
2. ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆ`--break-at`, `--break-on-start`ï¼‰
3. åŸºæœ¬ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰:
   - å®Ÿè¡Œåˆ¶å¾¡: `continue`, `step`, `next`, `out`
   - æƒ…å ±è¡¨ç¤º: `line`, `variables`, `print`
   - ãã®ä»–: `help`, `quit`
4. åŸºæœ¬çš„ãªçŠ¶æ…‹è¡¨ç¤ºï¼ˆç¾åœ¨è¡Œã€å¤‰æ•°ã€ãƒ¢ãƒ¼ãƒ‰ï¼‰
5. `breakpoint`ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã®è¿½åŠ 

**æœŸå¾…ã•ã‚Œã‚‹æˆæœç‰©:**
- `src/debugCLIRunner.ts`
- `src/cli.ts`ã¸ã®çµ±åˆ
- åŸºæœ¬å‹•ä½œç¢ºèªç”¨ã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### Phase 2: æ‹¡å¼µæ©Ÿèƒ½

**ç›®æ¨™**: ãƒ‡ãƒãƒƒã‚°ä½“é¨“ã®å‘ä¸Š

**å®Ÿè£…é …ç›®:**
1. ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯è¡¨ç¤ºï¼ˆ`stack`ã‚³ãƒãƒ³ãƒ‰ï¼‰
2. ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºçµ±åˆï¼ˆ`grid`ã‚³ãƒãƒ³ãƒ‰ï¼‰
3. ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆå‹•çš„ç®¡ç†:
   - `break <line>`: å®Ÿè¡Œä¸­ã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
   - `delete <line>`: ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆå‰Šé™¤
   - `breakpoints`: ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆä¸€è¦§
4. æ‹¡å¼µè¡¨ç¤ºæ©Ÿèƒ½:
   - `list [n]`: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¡Œæ•°æŒ‡å®š
   - `--context <n>`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š
5. ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ï¼ˆreadlineæ©Ÿèƒ½åˆ©ç”¨ï¼‰

### Phase 3: é«˜åº¦ãªæ©Ÿèƒ½

**ç›®æ¨™**: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã®ãƒ‡ãƒãƒƒã‚¬æ©Ÿèƒ½

**å®Ÿè£…é …ç›®:**
1. æ¡ä»¶ä»˜ããƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ:
   ```bash
   --break-when "A>10"
   debug> break 5 if A>10
   ```
2. ã‚¦ã‚©ãƒƒãƒãƒã‚¤ãƒ³ãƒˆï¼ˆå¤‰æ•°ç›£è¦–ï¼‰:
   ```bash
   debug> watch A
   debug> unwatch A
   ```
3. å®Ÿè¡Œå±¥æ­´ãƒˆãƒ¬ãƒ¼ã‚¹:
   ```bash
   debug> history
   debug> trace
   ```
4. ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«:
   ```bash
   # .wsbreakpoints ãƒ•ã‚¡ã‚¤ãƒ«
   2
   5
   10
   ```
5. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚³ãƒãƒ³ãƒ‰ã®è‡ªå‹•å®Ÿè¡Œï¼‰:
   ```bash
   npm run cli breakpoint test.ws --script debug-script.txt
   ```

## æŠ€è¡“çš„ãªè€ƒæ…®äº‹é …

### 1. Readlineçµ±åˆ

Node.jsã®`readline`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚³ãƒãƒ³ãƒ‰å…¥åŠ›ã‚’å®Ÿç¾:

```typescript
import * as readline from 'readline';

this.rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
    prompt: 'debug> '
});

// ã‚³ãƒãƒ³ãƒ‰å±¥æ­´æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–
this.rl.on('line', (line) => {
    this.handleCommand(line);
});
```

### 2. æ—¢å­˜æ©Ÿèƒ½ã¨ã®ç«¶åˆå›é¿

- `--realtime`ãƒ¢ãƒ¼ãƒ‰ã¨ã®ä½µç”¨ã¯éå¯¾å¿œï¼ˆç›¸äº’æ’ä»–ï¼‰
- `--quiet`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã¯ç„¡è¦–
- `--output`ã¯ãƒ‡ãƒãƒƒã‚°ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã®æœ€çµ‚çµæœã®ã¿ä¿å­˜

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- ç„¡åŠ¹ãªè¡Œç•ªå·æŒ‡å®šæ™‚ã®è­¦å‘Š
- å­˜åœ¨ã—ãªã„å¤‰æ•°å‚ç…§æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ã‚³ãƒãƒ³ãƒ‰è§£æã‚¨ãƒ©ãƒ¼ã®é©åˆ‡ãªé€šçŸ¥

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆãƒã‚§ãƒƒã‚¯ã¯WorkerInterpreterå†…éƒ¨ã§å®Ÿæ–½ï¼ˆæ—¢å­˜å®Ÿè£…ã‚’åˆ©ç”¨ï¼‰
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã¯æœ€å°é™ï¼ˆgenerator yieldã®è‡ªç„¶ãªæ´»ç”¨ï¼‰

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### å˜ä½“ãƒ†ã‚¹ãƒˆ

1. `DebugCLIRunner`ã®å„ãƒ¡ã‚½ãƒƒãƒ‰
2. ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆ`parseCommand()`ï¼‰
3. è¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°

### çµ±åˆãƒ†ã‚¹ãƒˆ

1. ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒãƒƒã‚°ã‚»ãƒƒã‚·ãƒ§ãƒ³
2. å„ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰ã®å‹•ä½œç¢ºèª
3. ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã¨ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã®é€£æº

### æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

1. ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã®å®Ÿéš›ã®ä½¿ç”¨æ„Ÿç¢ºèª
2. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆãƒã‚¹ãƒˆã—ãŸã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã€ãƒ«ãƒ¼ãƒ—ãªã©ï¼‰ã®æ¤œè¨¼
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ç¢ºèª

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### æ›´æ–°ãŒå¿…è¦ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

1. `docs/CLI.md`: `breakpoint`ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 
2. `README.md`: ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã®ç°¡æ½”ãªç´¹ä»‹
3. `docs/feature/251028-cli-debug-options/usage.md`: è©³ç´°ãªä½¿ç”¨æ–¹æ³•ï¼ˆæ–°è¦ä½œæˆï¼‰

## ã¾ã¨ã‚

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€WorkerInterpreterã«æ—¢ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã¨ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œæ©Ÿèƒ½ã‚’ã€CLIç’°å¢ƒã‹ã‚‰ç›´æ„Ÿçš„ã«åˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚GDBã‚„Node.js Debuggerã«é¡ä¼¼ã—ãŸã‚³ãƒãƒ³ãƒ‰ä½“ç³»ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºè€…ã«ã¨ã£ã¦è¦ªã—ã¿ã‚„ã™ã„ãƒ‡ãƒãƒƒã‚°ä½“é¨“ã‚’æä¾›ã§ãã¾ã™ã€‚

æ®µéšçš„ãªå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆPhase 1 â†’ 2 â†’ 3ï¼‰ã«ã‚ˆã‚Šã€MVPï¼ˆæœ€å°viable productï¼‰ã‚’æ—©æœŸã«æä¾›ã—ã¤ã¤ã€ç¶™ç¶šçš„ã«æ©Ÿèƒ½ã‚’æ‹¡å¼µã—ã¦ã„ãã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
