# プログラム仕様書

## 目的

画面上にcanvasでできた100x100のグリッドを表示し、ひもづいている配列をスクリプトから操作することで表示を変化させるプログラム。

## 概要

### UIレイアウト

画面は以下の要素で構成される。

1.  **Canvas:** 400x400pxのグリッド表示領域。
2.  **テキストエリア:** ユーザーがスクリプトを入力する領域。
3.  **実行ボタン:** テキストエリアのスクリプトを実行する。
4.  **保存ボタン:** 現在テキストエリアにあるWorkerScriptをローカルストレージに保存します。保存時にスクリプトのタイトルを入力するプロンプトが表示されます。
5.  **読み込み/削除エリア:** 保存されているスクリプトのタイトル一覧を表示し、選択したスクリプトをテキストエリアに読み込む「読み込み」ボタン、または削除する「削除」ボタンを提供します。
6.  **トランスクリプトエリア:** `log()`関数の出力やスクリプトのエラーメッセージを表示する領域。

### グリッド仕様

-   **表示:** 画面上に400x400pxのcanvasを作成し、100x100のグリッドを表示する。各グリッドセルは4x4pxの大きさとなる。
-   **データ管理:** `gridData`という名前の100x100=10000の要素を持つ整数の配列がグリッドの状態を表す。
-   **色:** 配列の要素が`0`のとき対応するグリッドの点は黒になり、`1`の場合は白になる。
-   **初期状態:** プログラム開始時、グリッドはすべて黒で表示される（`gridData`の全要素が`0`）。

### スクリプト実行環境

-   **実行:** テキストエリアに書かれたWorkerScriptコードは、実行ボタンを押すことで実行される。WorkerScriptの言語仕様については、`worker.md`を参照のこと。
-   **API:** スクリプトからは以下のグローバル関数にアクセスできる。
    -   `peek(index)`: `gridData`から指定したインデックスの値を読み出して返す。
    -   `poke(index, value)`: `gridData`の指定したインデックスに値を書き込み、即座に対応するグリッドセルを再描画する。
    -   `log(...args)`: 渡された引数を画面上のトランスクリプトエリアに出力する。

### スクリプト実行のセマンティクス

-   WorkerScriptインタプリタは、外部からのクロック（ティック）に応じて、一度に1つのステートメントを実行します。
-   これは、インタプリタがGenerator Functionとして実装されており、メインアプリケーションがGeneratorの`next()`メソッドを呼び出すことで実現されます。
-   `next()`が呼び出されるたびに、インタプリタは次のステートメントを実行し、実行が継続可能であるかを示す値を返します。
-   スクリプトの実行が完了するか、エラーが発生した場合、Generatorは実行終了を示します。
-   このメカニズムにより、複数のWorkerScriptを協調的マルチタスクとして同時に実行することが可能になります。

-   **エラーハンドリング:** スクリプトの実行中に発生したエラーは、トランスクリプトエリアに表示される。

### スクリプトの保存と読み込み

-   ユーザーはテキストエリアに入力したWorkerScriptコードを、ブラウザのローカルストレージ（またはそれに類する機能）に保存できます。
-   保存されたスクリプトは、タイトルをキーとして管理され、一覧から選択してテキストエリアに読み込んだり、削除したりできます。
-   保存されるスクリプトの数やサイズには、ブラウザのローカルストレージの一般的な制限が適用されます。